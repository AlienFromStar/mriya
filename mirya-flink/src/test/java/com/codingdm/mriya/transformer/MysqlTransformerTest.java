package com.codingdm.mriya.transformer;

import com.codingdm.mriya.model.Message;
import com.codingdm.mriya.transformer.imp.MysqlTransformer;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;

import java.util.List;

/**
 * @author wudongming1
 * @email dongming1.wu@genscript.com
 * @Date 6/8/2020 9:57 AM
 **/
@Slf4j
public class MysqlTransformerTest {

    @Test
    public void getColumnStr(){
        String jsonString = "{\"data\":null,\"database\":\"mriya\",\"es\":1591173007000,\"id\":21,\"isDdl\":false,\"mergeData\":[{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"15.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"15.0\",\"t9\":\"15\",\"id\":\"22\",\"t1\":\"22\",\"t2\":\"15\",\"t3\":\"15.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_22\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"11.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"11.0\",\"t9\":\"11\",\"id\":\"11\",\"t1\":\"11\",\"t2\":\"11\",\"t3\":\"11.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_11\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"14.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"14.0\",\"t9\":\"14\",\"id\":\"21\",\"t1\":\"21\",\"t2\":\"14\",\"t3\":\"14.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_21\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"10.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"10.0\",\"t9\":\"10\",\"id\":\"10\",\"t1\":\"10\",\"t2\":\"10\",\"t3\":\"10.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_10\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"13.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"13.0\",\"t9\":\"13\",\"id\":\"20\",\"t1\":\"20\",\"t2\":\"13\",\"t3\":\"13.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_20\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"19.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"19.0\",\"t9\":\"19\",\"id\":\"26\",\"t1\":\"26\",\"t2\":\"19\",\"t3\":\"19.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_26\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"14.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"14.0\",\"t9\":\"14\",\"id\":\"14\",\"t1\":\"14\",\"t2\":\"14\",\"t3\":\"14.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_14\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"18.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"18.0\",\"t9\":\"18\",\"id\":\"25\",\"t1\":\"25\",\"t2\":\"18\",\"t3\":\"18.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_25\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"17.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"17.0\",\"t9\":\"17\",\"id\":\"24\",\"t1\":\"24\",\"t2\":\"17\",\"t3\":\"17.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_24\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"16.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"16.0\",\"t9\":\"16\",\"id\":\"23\",\"t1\":\"23\",\"t2\":\"16\",\"t3\":\"16.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_23\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"12.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"12.0\",\"t9\":\"12\",\"id\":\"12\",\"t1\":\"12\",\"t2\":\"12\",\"t3\":\"12.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_12\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"9.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"9.0\",\"t9\":\"9\",\"id\":\"9\",\"t1\":\"9\",\"t2\":\"9\",\"t3\":\"9.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_9\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"7.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"7.0\",\"t9\":\"7\",\"id\":\"7\",\"t1\":\"7\",\"t2\":\"7\",\"t3\":\"7.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_7\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"8.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"8.0\",\"t9\":\"8\",\"id\":\"8\",\"t1\":\"8\",\"t2\":\"8\",\"t3\":\"8.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_8\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"5.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"5.0\",\"t9\":\"5\",\"id\":\"5\",\"t1\":\"5\",\"t2\":\"5\",\"t3\":\"5.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_5\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"6.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"6.0\",\"t9\":\"6\",\"id\":\"6\",\"t1\":\"6\",\"t2\":\"6\",\"t3\":\"6.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_6\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"3.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"3.0\",\"t9\":\"3\",\"id\":\"3\",\"t1\":\"3\",\"t2\":\"3\",\"t3\":\"3.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_3\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"4.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"4.0\",\"t9\":\"4\",\"id\":\"4\",\"t1\":\"4\",\"t2\":\"4\",\"t3\":\"4.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_4\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"1.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"1.0\",\"t9\":\"1\",\"id\":\"1\",\"t1\":\"1\",\"t2\":\"1\",\"t3\":\"1.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_1\",\"type\":\"DELETE\"},{\"data\":{\"t4\":\"2020-06-03\",\"t5\":\"01:00:00\",\"t6\":\"2020-06-03 09:27:28\",\"t10\":\"2.0\",\"t7\":\"2020-06-03 17:27:34\",\"t8\":\"2.0\",\"t9\":\"2\",\"id\":\"2\",\"t1\":\"2\",\"t2\":\"2\",\"t3\":\"2.0\"},\"pkNames\":null,\"pkValues\":null,\"pkValuesId\":\"canal224_mriya_table_t1_2\",\"type\":\"DELETE\"}],\"mysqlType\":{\"t4\":\"date\",\"t5\":\"time\",\"t6\":\"datetime\",\"t10\":\"decimal(10,3)\",\"t7\":\"timestamp\",\"t8\":\"double\",\"t9\":\"text\",\"id\":\"int(255)\",\"t1\":\"varchar(100)\",\"t2\":\"varchar(200)\",\"t3\":\"float\"},\"old\":null,\"pkNames\":[\"id\"],\"sql\":\"\",\"sqlType\":{\"t4\":91,\"t5\":92,\"t6\":93,\"t10\":3,\"t7\":93,\"t8\":8,\"t9\":2005,\"id\":4,\"t1\":12,\"t2\":12,\"t3\":7},\"table\":\"table_t1\",\"targetTable\":\"canal224_mriya_table_t1\",\"topic\":\"canal224\",\"ts\":1591173007948,\"type\":\"DELETE\"}";
        Message message = Message.buildMessage(jsonString, "topic");
        Transformer transformer = new MysqlTransformer();
        List<String> columnsList = transformer.getColumnsList(message);
        columnsList.forEach(System.out::println);
    }
}
